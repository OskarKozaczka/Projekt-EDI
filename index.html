<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
</head>
<body>


<input type="text" name="firstname">
<button onclick="search()">szukaj</button>


    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th scope="col" style="text-align: left;">Nazwa</th>
                <th scope="col">Cena</th>

            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>








<script>
var letter="";

function search()
{

letter=document.querySelector("input").value

display2()
}










var letter="";


function display2()
{


var request=new XMLHttpRequest();
request.onreadystatechange = function()
{
    if (this.readyState == 4 && this.status == 200)
    {  
        Response=JSON.parse(this.responseText)

        display()

    }

    
}
request.open("GET","https://api.twelvedata.com/stocks" );
request.send();

}


    



function display()
{
    
    var Cena=0;


    var regexp = new RegExp(letter, "i");



    Response.data.forEach(element => {

        if(element.symbol.match(regexp))
        {

var request=new XMLHttpRequest();
request.onreadystatechange = function()
{
    if (this.readyState == 4 && this.status == 200)
    {  
        Response2=JSON.parse(this.responseText)



        Cena=Response2.values["0"]["close"]

        let output = `
            <td>${element["name"]}</td>
            <td>${Cena}</td>

        `
        let row = document.createElement("tr") 
        row.innerHTML = output
    
        document.querySelector("tbody").appendChild(row)

    
    }

    
}
request.open("GET","https://api.twelvedata.com/time_series?symbol="+element.symbol+"&interval=1day&apikey=a3e9aa227fd0474494e62f3148d0d7e0&outputsize=1" );
request.send();




}




    });


}








</script>

</body>
</html>